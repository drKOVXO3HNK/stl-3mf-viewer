<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neofab 3D Viewer (STL/3MF)</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/online-3d-viewer@0.18.0/build/engine/o3dv.min.js"></script>
</head>
<body>
  <main class="app">
    <h1>Neofab 3D Viewer</h1>
    <p class="sub">Движок: 3dviewer.net · Форматы: STL, 3MF и др.</p>

    <section class="controls">
      <label class="btn">
        Выбрать STL/3MF
        <input id="fileInput" type="file" accept=".stl,.3mf" multiple />
      </label>
      <button id="clearBtn" class="btn btn-ghost">Очистить</button>
      <span id="status">Файл не загружен</span>
    </section>

    <section id="viewer" class="viewer"></section>
  </main>

  <script>
    const input = document.getElementById('fileInput');
    const clearBtn = document.getElementById('clearBtn');
    const status = document.getElementById('status');
    const parent = document.getElementById('viewer');

    let currentViewer = null;

    function loadFiles(files) {
      if (!files || files.length === 0) return;
      parent.innerHTML = '';
      currentViewer = OV.Init3DViewerFromFileList(parent, [...files], {
        backgroundColor: new OV.RGBAColor(10, 18, 38, 255),
        defaultColor: new OV.RGBColor(220, 230, 255),
        edgeSettings: new OV.EdgeSettings(false, new OV.RGBColor(0, 0, 0), 1),
      });
      status.textContent = `Загружено: ${[...files].map(f => f.name).join(', ')}`;
    }

    input.addEventListener('change', (e) => loadFiles(e.target.files));

    clearBtn.addEventListener('click', () => {
      parent.innerHTML = '';
      currentViewer = null;
      input.value = '';
      status.textContent = 'Файл не загружен';
    });

    // drag&drop
    ['dragenter', 'dragover'].forEach((ev) => {
      parent.addEventListener(ev, (e) => {
        e.preventDefault();
        parent.classList.add('drag');
      });
    });
    ['dragleave', 'drop'].forEach((ev) => {
      parent.addEventListener(ev, (e) => {
        e.preventDefault();
        parent.classList.remove('drag');
      });
    });
    parent.addEventListener('drop', (e) => loadFiles(e.dataTransfer.files));
  </script>
</body>
</html>
